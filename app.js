'use strict'

import "/JsBarcode.all.min.js";

const createBarCode = (number) => {
  let barCode = '2220000000000'
  let slicer = barCode.length - String(number).length
  return barCode.slice(0, slicer) + String(number)
}
const createSpecialBarCode = (number, barSymbols) => {
  let barCode = '222' + '0'.repeat(barSymbols)
  let slicer = barCode.length - String(number).length
  return barCode.slice(0, slicer) + String(number)
}


const Cells = {
  cell_b1: {
    name: 'б1',
    '1а': 48,
    '1б': 31,
    '1в': 24,
    '1г': 17,
    '2а': 1472,
    '2б': 1465,
    '2в': 1458,
    '2г': 1557,
    '3а': 1632,
    '3б': 1502,
    '3в': 1540,
    '3г': 1489,
    '4а': 1663,
    '4б': 1656,
    '4в': 1595,
    '4г': 1533,
    '5а': 1588,
    '5б': 864,
    '5в': 1618,
    '5г': 1601,
    '6а': 1670,
    '6б': 1038,
    '6в': 1281,
    '6г': 1052,
  },
  cell_b2: {
    name: 'б2',
    '1а': 5074,
    '1б': 1762,
    '1в': 2967,
    '1г': 3452,
    '2а': 3438,
    '2б': 5463,
    '2в': 3766,
    '2г': 6798,
    '3а': 4947,
    '3б': 3827,
    '3в': 5586,
    '3г': 3957,
    '4а': 5289,
    '4б': 7399,
    '4в': 3919,
    '4г': 5258,
    '5а': 628,
    '5б': 284,
    '5в': 369,
    '5г': 6309,
    '6а': 6569,
    '6б': 574,
    '6в': 758,
    '6г': 635,
    '7а': 239,
    '7б': 6620,
    '7в': 741,
    '7г': 6415,
    '8а': 598,
    '8б': 352,
    '8в': 826,
    '8г': 6682,
    '9а': 6347,
    '9б': 6286,
    '9в': 6224,
    '9г': 6163,
    '10а': 1076,
    '10б': 1083,
    '10в': 925,
    '10г': 1380,
    '11а': 1137,
    '11б': 932,
    '11в': 949,
    '11г': 1311,
    '12а': 901,
    '12б': 1564,
    '12в': 1298,
    '12г': 956,
    '13а': 1243,
    '13б': 1649,
    '13в': 871,
    '13г': 1342,
    '14а': 1199,
    '14б': 1366,
    '14в': 1212,
    '14г': 1373,
    '15а': 895,
    '15б': 1359,
    '15в': 888,
    '15г': 1229,
  },
  cell_b3: {
    name: 'б3',
    '1а': 1236,
    '1б': 1625,
    '1в': 1496,
    '1г': 1090,
    '2а': 994,
    '2б': 987,
    '2в': 1519,
    '2г': 1007,
    '3а': 1069,
    '3б': 970,
    '3в': 1113,
    '3г': 857,
    '4а': 1267,
    '4б': 1328,
    '4в': 1205,
    '4г': 1304,
    '5а': 1250,
    '5б': 1441,
    '5в': 1434,
    '5г': 918,
    '6а': 1427,
    '6б': 1120,
    '6в': 1144,
    '6г': 963,
    '7а': 536,
    '7б': 6002,
    '7в': 6149,
    '7г': 6262,
    '8а': 437,
    '8б': 6385,
    '8в': 5999,
    '8г': 6200,
    '9а': 5944,
    '9б': 5968,
    '9в': 5975,
    '9г': 6088,
    '10а': 208,
    '10б': 840,
    '10в': 6576,
    '10г': 5951,
    '11а': 4183,
    '11б': 4480,
    '11в': 7351,
    '11г': 5050,
    '12а': 833,
    '12б': 468,
    '12в': 529,
    '12г': 345,
    '13а': 642,
    '13б': 710,
    '13в': 6637,
    '13г': 6330,
    '14а': 765,
    '14б': 6736,
    '14в': 6866,
    '14г': 6903,
    '15а': 703,
    '15б': 6491,
    '15в': 6095,
    '15г': 6552,
  },
  cell_b4: {
    name: 'б4',
    '1д': 9119,
    '1е': 9782,
    '1ж': 8488,
    '1з': 3803,
    '1а': 10177,
    '1б': 10115,
    '1в': 10153,
    '1г': 10092,
    '2а': 10238,
    '2б': 10290,
    '2в': 10351,
    '2г': 10412,
    '3а': 10535,
    '3б': 10474,
    '3в': 10597,
    '3г': 10658,
    '4а': 10719,
    '4б': 10894,
    '4в': 10832,
    '4г': 10771,
    '5а': 5937,
    '5б': 482,
    '5в': 604,
    '5г': 420,
    '6а': 789,
    '6б': 6422,
    '6в': 406,
    '6г': 222,
    '7а': 499,
    '7б': 253,
    '7в': 796,
    '7г': 215,
    '8а': 376,
    '8б': 321,
    '8в': 192,
    '8г': 260,
    '9а': 4329,
    '9б': 4312,
    '9в': 4350,
    '9г': 4923,
    '10а': 4374,
    '10б': 4213,
    '10в': 4428,
    '10г': 4411,
    '11а': 4398,
    '11б': 4251,
    '11в': 4589,
    '11г': 4596,
    '12а': 4602,
    '12б': 4534,
    '12в': 4268,
    '12г': 4442,
    '13а': 4572,
    '13б': 4541,
    '13в': 4367,
    '13г': 4404,
    '14а': 4299,
    '14б': 4435,
    '14в': 4671,
    '14г': 4657,
    '15а': 4244,
    '15б': 4336,
    '15в': 4343,
    '15г': 4558,

  },
  cell_b5: {
    name: 'б5',
    '1а': 3674,
    '1б': 2875,
    '1в': 5791,
    '1г': 3551,
    '2а': 5081,
    '2б': 5326,
    '2в': 5739,
    '2г': 5715,
    '3а': 5876,
    '3б': 6828,
    '3в': 5067,
    '3г': 5098,
    '4а': 5425,
    '4б': 5746,
    '4в': 1915,
    '4г': 3308,
    '5а': 5722,
    '5б': 5104,
    '5в': 5333,
    '5г': 5432,
    '6а': 819,
    '6б': 697,
    '6в': 291,
    '6г': 475,
    '7а': 413,
    '7б': 6170,
    '7в': 390,
    '7г': 451,
    '8а': 277,
    '8б': 338,
    '8в': 802,
    '8г': 512,
    '9а': 444,
    '9б': 567,
    '9в': 505,
    '9г': 680,
    '10а': 6323,
    '10б': 611,
    '10в': 6507,
    '10г': 383,
    '11а': 10245,
    '11б': 10306,
    '11в': 10368,
    '11г': 10429,
    '12а': 10870,
    '12б': 10818,
    '12в': 10757,
    '12г': 10696,
    '13а': 10672,
    '13б': 10610,
    '13в': 10559,
    '13г': 10498,
    '14а': 10917,
    '14б': 10856,
    '14в': 10795,
    '14г': 10733,
    '15а': 10139,
    '15б': 10191,
    '15в': 10252,
    '15г': 10313,
    '16а': 9348,
    '16б': 2769,
    '16в': 9744,
    '16г': 2271,
  },
  cell_b6: {
    name: 'б6',
    '1а': 6392,
    '1б': 6125,
    '1в': 314,
    '1г': 7559,
    '2а': 6316,
    '2б': 6378,
    '2в': 6248,
    '2г': 6439,
    '3а': 6194,
    '3б': 6255,
    '3в': 6071,
    '3г': 6675,
    '4а': 5852,
    '4б': 659,
    '4в': 581,
    '4г': 6101,
    '5а': 6231,
    '5б': 6293,
    '5в': 6354,
    '5г': 6477,
    '6а': 6538,
    '6б': 6651,
    '6в': 6712,
    '6г': 6590,
  },
  cell_b7: {
    name: 'б7',
    '1а': 10221,
    '1б': 10283,
    '1в': 10528,
    '1г': 10467,
    '2а': 10108,
    '2б': 10160,
    '2в': 10344,
    '2г': 10405,
    '3а': 10726,
    '3б': 10788,
    '3в': 10900,
    '3г': 10849,
    '4а': 10481,
    '4б': 10542,
    '4в': 10603,
    '4г': 10665,
    '5а': 10122,
    '5б': 10184,
    '5в': 10801,
    '5г': 10740,
    '6а': 10504,
    '6б': 10566,
    '6в': 10627,
    '6г': 10689,
    '7а': 10269,
    '7б': 10320,
    '7в': 10382,
    '7г': 10443,
    '8а': 6408,
    '8б': 6460,
    '8в': 6521,
    '8г': 6583,
    '9а': 6705,
    '9б': 6118,
    '9в': 6361,
    '9г': 6644,
    '10а': 6446,
    '10б': 550,
    '10в': 734,
    '10г': 673,
    '11а': 4749,
    '11б': 5012,
    '11в': 4930,
    '11г': 4992,
    '12а': 4800,
    '12б': 4466,
    '12в': 4473,
    '12г': 4763,
    '13а': 4794,
    '13б': 4824,
    '13в': 4831,
    '13г': 4916,
    '14а': 4770,
    '14б': 4497,
    '14в': 3476,
    '14г': 4909,
    '15а': 3483,
    '15б': 3506,
    '15в': 3513,
    '15г': 4756,
    '16а': 10924,
    '16б': 10863,
    '16в': 10146,
    '16г': 10207,
    '17а': 3704,
    '17б': 3544,
    '17в': 4305,
    '17г': 3391,
    '18а': 3575,
    '18б': 3582,
    '18в': 4282,
    '18г': 3605,
  },
  cell_a1: {
    name: 'а1',
    '1а': 3537,
    '1б': 6729,
    '1в': 1274,
    '2а': 1182,
    '2б': 6484,
    '2в': 3353,
    '3а': 7054,
    '3б': 2424,
    '3в': 2431,
    '4а': 5906,
    '4б': 2585,
    '4в': 246,
    '5а': 5920,
    '5б': 3377,
    '5в': 5982,
    '6а': 2301,
    '6б': 6279,
    '6в': 6453,
  },
  cell_a2: {
    name: 'а2',
    '1а': 2837,
    '1б': 2059,
    '1в': 1397,
    '2а': 3407,
    '2б': 6781,
    '2в': 1175,
    '3а': 2073,
    '3б': 6514,
    '3в': 666,
    '4а': 727,
    '4б': 6699,
    '4в': 543,
    '5а': 3995,
    '6а': 7085,
    '6б': 6545,
    '6в': 6613,
    '7а': 772,
    '7б': 6668,
    '7в': 307,
  },
  cell_a3: {
    name: 'а3',
    '1а': 2325,
    '1б': 2202,
    '1в': 2219,
    '2а': 7078,
    '2б': 5777,
    '2в': 5685,
    '3а': 2080,
    '3б': 2172,
    '3в': 1151,
    '4а': 0,
    '4б': 7481,
    '4в': 7429,
    '5а': 6972,
    '6а': 1687,
    '6б': 1106,
    '6в': 1335,
    '7а': 2011,
    '7б': 1021,
    '7в': 6132,
  },
  cell_a4: {
    name: 'а4',
    '1а': 2448,
    '1б': 2134,
    '1в': 2110,
    '2а': 2646,
    '2б': 2400,
    '2в': 2127,
    '3а': 1939,
    '3б': 2158,
    '3в': 6842,
    '4а': 2141,
    '4б': 2189,
    '4в': 2196,
    '5а': 1885,
    '6а': 1830,
    '6б': 1847,
    '6в': 1571,
    '7а': 2806,
    '7б': 1823,
    '7в': 5678,
    '8а': 5654,
    '8б': 7313,
    '8в': 5548,
    '9а': 1403,
    '9б': 3568,
    '9в': 3636,
  },
  cell_a5: {
    name: 'а5',
    '1а': 3643,
    '1б': 5630,
    '1в': 7436,
    '2а': 6958,
    '2б': 6996,
    '2в': 5210,
    '3а': 7016,
    '3б': 6965,
    '3в': 3599,
    '4а': 5470,
    '4б': 5456,
    '4в': 1854,
    '5а': 1984,
    '6а': 5234,
    '6б': 5265,
    '6в': 2479,
    '7а': 5708,
    '7б': 5821,
    '7в': 5845,
    '8а': 5173,
    '8б': 3681,
    '8в': 7320,
    '9а': 8655,
    '9б': 3216,
    '9в': 9270,
  },
  cell_a6: {
    name: 'а6',
    '1а': 5883,
    '1б': 1908,
    '1в': 2820,
    '2а': 5524,
    '2б': 3940,
    '2в': 6910,
    '3а': 3797,
    '3б': 5500,
    '3в': 5517,
    '4а': 5364,
    '4б': 4220,
    '4в': 7238,
    '5а': 1892,
    '6а': 4503,
    '6б': 2516,
    '6в': 2981,
    '7а': 12232,
    '7б': 12256,
    '7в': 12270,
  },
  cell_a7: {
    name: 'а7',
    '1а': 1793,
    '1б': 7092,
    '1в': 7504,
    '2а': 1779,
    '2б': 7443,
    '2в': 5395,
    '3а': 2165,
    '3б': 2028,
    '3в': 3162,
    '4а': 12263,
    '4б': 12249,
    '4в': 12287,
  },
  cell_p: {
    name:'п',
    '0': 9959,
    '1': 3773,
    '2': 3759,
    '3': 1922,
    '4': 3780,
    '5': 2714,
    '6': 4053,
    '7': 4169,
    '8': 3315,
    '9': 3292,
    '10': 3049,
    '11': 4206,
    '12': 4107,
    '13': 9430,
    '14': 7917,
  },
  cell_c: {
    name:'с',
    '1': 8617,
    '2': 7634,
    '3': 7832,
    '4': 2257,
    '5': 9805,
    '6': 9706,
    '7': 7654,
  },
  cell_x: {
    name:'х',
    '1': 6217,
    '2': 6156,
    '3': 7412,
    '3-х1': 9775,
    '3-х2': 9157,
    '3-х3': 9614,
    '3-х4': 4091,
    '4': 9904,
    '4-х1': 123,
    '4-х2': 3339,
    '4-х3': 4978,
    '4-х4': 9652,
    '4-х5': 8594,
    '4-х6': 4626,
    '4-х7': 1717,
    '4-х8': 5166,
  },
  cell_m: {
    name:'м',
    '1': 9515,
    '2': 9522,
    '3': 8969,
    '4': 2721,
    '5': 8891,
    '6': 1694,
    '7': 7061,
    '8': 9492,
    '9': 1110,
    '10': 1010,
    '11': 9263,
    '12': 7993,
    '13': 8433,
    '14': 9751,
    '15': 5128,
    '16': 9256,
    '17': 12195,
    '18': 12201,
    '19': 12218,
    '20': 12225,
  },
  cell_V1: {
    name: 'в1',
    '1п': 2004,
    '2п': 2042,
    '4п': 2578,
    '5п': 2509,
    '6п': 2868,
    '8п': 5609,
    '11п': 5449,
    '12п': 4879,
    '13п': 6934,
    '14п': 7009,
    '15п': 3223,
    '16п': 1991,
    '17п': 7122,
    '18п': 2066,
  },
  cell_V2: {
    name: 'в2',
    '1п': 2844,
    '3п': 2783,
    '10п': 2745,
    '12п': 3889,
    '13п': 5555,
  },
  cell_V3: {
    name: 'в3',
    '2п': 5180,
    '7п': 2394,
    '8п': 2387,
    '10п': 1526,
    '11п': 5319,
    '12п': 5418,
    '14п': 7115,
    '15п': 5197,
    '16п': 3094,
  },
  
  
  
}






const findObjects = (findString) => {
  searchResults.innerHTML = ''
  searchResults.setAttribute('hidden', '')
  
  let string = findString.toLowerCase().split('.')
  let results = []
  let subCells = []
  if (searchArea.value != '') {

  for (let key in Cells) {
    let cellName = Cells[key]['name']

    if (cellName.startsWith(string[0])) {
      searchResults.removeAttribute('hidden', '')

      
      for (let subKey in Cells[key]) {
        if(subKey != 'name'){
          subCells.push(subKey)
        }
      }
      
      if (string.length > 1) {
        let findedCells = subCells.forEach((elem) => {
          if(elem.startsWith(string[1])) {
            results.push(`${cellName}.${elem}`)
          }
          
        })
      }else {
        subCells.forEach((elem) => {
          results.push(`${cellName}.${elem}`)
        })
      }

  
     
    }
  }
  results.forEach((elem) => {
    searchResults.insertAdjacentHTML('beforeend',`<span class="mainText">
      ${elem.toUpperCase()}
      </span>`)
  })  
}
}


const searchResults = document.querySelector('.searchResults')
const imgBarCode = document.querySelector('#barcode')
const searchArea = document.querySelector('.searchArea')
const searchText = document.querySelector('.mainText')
const cellArea = document.querySelector('.cellArea')
searchArea.addEventListener('input', () => findObjects(searchArea.value.trim()))
searchResults.addEventListener('click', (event) => clickOnCell(event.target.textContent))







const getCell = (cell) => {
  let findingCell = cell.trim().toLowerCase().split('.')
  for (let key in Cells) {
    let currentCell = Cells[key]
    if (currentCell['name'] == findingCell[0]) {
      let finalCellName = (currentCell['name'] +'.' + findingCell[1]).toUpperCase()
      let finalBarCode = currentCell[findingCell[1]]

      if (finalCellName == 'С.3'){
        return {
          cellName: finalCellName,
          barCode: '2' + createBarCode(finalBarCode),
        }
      }

      if (finalCellName == 'М.9' || finalCellName == 'М.10') {
        return {
          cellName: finalCellName,
          barCode: createSpecialBarCode(finalBarCode, 6),
        }
      }

      return {
        cellName: finalCellName,
        barCode: createBarCode(finalBarCode),
      }
    }
  }
}

const clickOnCell = (target) => {
  if(searchArea.value != '') {  
    searchArea.value = ''
    findObjects(searchArea.value)

    let cell = getCell(target)

    JsBarcode("#barcode", cell['barCode']);
    cellArea.innerHTML = 
      `<span class="resultText">
      Ячейка: ${cell['cellName']}

      </span>`
    
  }
  }




